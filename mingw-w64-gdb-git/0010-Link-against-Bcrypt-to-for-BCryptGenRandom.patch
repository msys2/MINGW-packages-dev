From c79fd63bdde94c333d51f60befd12ab04e46867b Mon Sep 17 00:00:00 2001
From: Liu Hao <lh_mouse@126.com>
Date: Mon, 26 Oct 2020 21:41:53 +0800
Subject: [PATCH] Link against Bcrypt to for `BCryptGenRandom()`

Signed-off-by: Liu Hao <lh_mouse@126.com>
---
 gdb/Makefile.in      | 4 ++--
 gdb/configure        | 2 +-
 gdbsupport/common.m4 | 2 +-
 gdbsupport/configure | 2 +-
 4 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/gdb/Makefile.in b/gdb/Makefile.in
index 53beb3ab254..f95054b5f11 100644
--- a/gdb/Makefile.in
+++ b/gdb/Makefile.in
@@ -638,9 +638,9 @@ CLIBS = $(SIM) $(READLINE) $(OPCODES) $(LIBCTF) $(BFD) $(ZLIB) \
 	$(XM_CLIBS) $(GDBTKLIBS) \
 	@LIBS@ @GUILE_LIBS@ @PYTHON_LIBS@ \
 	$(LIBEXPAT) $(LIBLZMA) $(LIBBABELTRACE) $(LIBIPT) \
-	$(WIN32LIBS) $(LIBGNU) $(LIBGNU_EXTRA_LIBS) $(LIBICONV) \
+	$(LIBGNU) $(LIBGNU_EXTRA_LIBS) $(LIBICONV) \
 	$(LIBMPFR) $(LIBGMP) $(SRCHIGH_LIBS) $(LIBXXHASH) $(PTHREAD_LIBS) \
-	$(DEBUGINFOD_LIBS)
+	$(DEBUGINFOD_LIBS) $(WIN32LIBS)
 CDEPS = $(NAT_CDEPS) $(SIM) $(BFD) $(READLINE_DEPS) $(CTF_DEPS) \
 	$(OPCODES) $(INTL_DEPS) $(LIBIBERTY) $(CONFIG_DEPS) $(LIBGNU) \
 	$(LIBSUPPORT)
diff --git a/gdb/configure b/gdb/configure
index f25b51e5e6e..2904da0a8fa 100755
--- a/gdb/configure
+++ b/gdb/configure
@@ -13379,7 +13379,7 @@ fi
 
 $as_echo "#define USE_WIN32API 1" >>confdefs.h
 
-      WIN32APILIBS="-lws2_32"
+      WIN32APILIBS="-lws2_32 -lbcrypt"
       ;;
   esac
 
diff --git a/gdbsupport/common.m4 b/gdbsupport/common.m4
index 901c454ea8c..3a0ff7525ea 100644
--- a/gdbsupport/common.m4
+++ b/gdbsupport/common.m4
@@ -32,7 +32,7 @@ AC_DEFUN([GDB_AC_COMMON], [
 		 POSIX API.  On Windows, we use the Windows API when
 		 building for MinGW, but the POSIX API when building
 		 for Cygwin.])
-      WIN32APILIBS="-lws2_32"
+      WIN32APILIBS="-lws2_32 -lbcrypt"
       ;;
   esac
 
diff --git a/gdbsupport/configure b/gdbsupport/configure
index a9dd02c5b72..7665fd04af5 100755
--- a/gdbsupport/configure
+++ b/gdbsupport/configure
@@ -7685,7 +7685,7 @@ fi
 
 $as_echo "#define USE_WIN32API 1" >>confdefs.h
 
-      WIN32APILIBS="-lws2_32"
+      WIN32APILIBS="-lws2_32 -lbcrypt"
       ;;
   esac
 
-- 
2.32.0

